#summary Setup Huawei E160E USB 3G Modem with Ubuntu 9.10

= Introduction =

There was several issues with the Ubuntu 9.10.<br />
First things first.<br />

_Update the kernel!_
{{{
sudo apt-get install linux
}}}

And the kernel headers as well:
{{{
sudo apt-get install linux-headers-[your kernel version]
}}}

== Disable PIN query ==
Remember to disable PIN query for the SIM card which you are using. This will ease the pain as well.
  * Note: If you have a fixed data plan and you have blocked all phone calls and sms, etc. then there is no real risk from this one. At least this is my opinion on this matter. But still do this at your own risk.

== Remember ~60s boot-up time ==
The modem will boot for about 60 seconds. As it will first enable internal cd-rom emulation and the micro-sd drive for the operating system. After those ones it will enable the modem functionality. So it takes time as the OS might scan the disk drives as well, etc.

= How I did it =

It really seems that for a computer which has E160E as primary network device and always connected the NetworkManager is not the optimal solution at all.
== install the applications ==
  * Install wvdial and supervisor
{{{
sudo apt-get install wvdial python-setuptools
sudo easy_install supervisor
}}}
== wvdial ==
  * Configure wvdial (example for [http://www.saunalahti.fi Saunalahti]):
{{{
[Dialer Defaults]
Modem = /dev/ttyUSB0
Baud = 921600
Init1 = AT+CGDCONT=1,"IP","internet.saunalahti"
Phone = *99***1#
Carrier Check = off
Auto DNS = off
Stupid Mode = 1
Username = " "
Password = " "
}}}
== pppd ==
Comment out usepeerdns (/etc/ppp/peers/wvdial)

== supervisord ==
  * Create configuration template for _supervisord_:
{{{
echo_supervisord_conf > supervisord.conf
sudo mv supervisord.conf /etc/supervisord.conf
}}}
  * Configure _supervisord_ (/etc/supervisord.conf):
{{{
[program:saunalahti]
command=/usr/bin/wvdial
autostart=true
autorestart=true
process_name=wvdial
startretries=10
}}}
== make them run @ boot time and on request ==
  * Make _supervisord_ run on the boot time, add a line to /etc/rc.local:
{{{
/usr/local/bin/supervisord
}}}
  * Get vendor and device id:
{{{
lsmod | grep Huawei
}}}
  * Create a rules for the udev (/etc/udev/rules.d/99-wvdial.rules):
{{{
ACTION=="add", ATTRS{vendor}=="0x12d1", ATTRS{device}=="0x1003", KERNEL=="ttyUSB0", RUN="supervisorctl start saunalahti:wvdial"
ACTION=="remove", ATTRS{vendor}=="0x12d1", ATTRS{device}=="0x1003", KERNEL=="ttyUSB0", RUN="supervisorctl stop saunalahti:wvdial"
}}}
= post installation =
== enable proxy server for increased security ==
As you browse web now with your mobile, you are showing your mobile phone number as well. So it would make sense to enable proxy servers.<br /><br />
Edit /etc/bash.bashrc and add following lines:
{{{
export http_proxy="http://varasto.saunalahti.fi:80"
export ftp_proxy="http://varasto.saunalahti.fi:80"
}}}

== enable local dns cache and OpenDNS ==
It seems that the dns queries will take a lot of time over the 3G connection, so the local dns cache actually would make a huge difference.
{{{
sudo apt-get install dnsmasq
}}}
Configure the dnsmasq (/etc/dnsmasq.conf) by adding line:
{{{
listen-address=127.0.0.1
}}}
Reboot the service:
{{{
sudo /etc/init.d/dnsmasq restart
}}}
Take dns service into use, edit (/etc/resolv.conf):
{{{
nameserver 127.0.0.1
nameserver 208.67.222.222
nameserver 208.67.220.220
}}}